/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JPanel.java to edit this template
 */
package com.kazcables.forms;

import com.kazcabels.model.Branch;
import com.kazcabels.model.Client;
import com.kazcabels.model.Department;
import com.kazcabels.model.HierarchyLevel;
import com.kazcabels.model.Organization;
import com.kazcables.recordview.ClientRecords;
import java.util.List;
import javax.swing.DefaultComboBoxModel;
import javax.swing.JDialog;
import javax.swing.JOptionPane;

public class addClient extends javax.swing.JPanel
{
    private final ClientRecords clientRecords;
    private final Organization organization;
    private final JDialog jd;
    
    public addClient(Organization org,ClientRecords clientRecords, JDialog jd)
    {
        initComponents();
        
        this.clientRecords= clientRecords;
        this.organization = org;
        this.jd = jd;
        
        String[] branchNames = this.organization.getBranchNames();
        DefaultComboBoxModel<String> model = new DefaultComboBoxModel<>(branchNames);
        jcb_branch.setModel(model);
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        lbl_email = new javax.swing.JLabel();
        jbl_phone = new javax.swing.JLabel();
        tf_client_name = new javax.swing.JTextField();
        tf_phone = new javax.swing.JTextField();
        jcb_branch = new javax.swing.JComboBox<>();
        tf_email = new javax.swing.JTextField();
        lbl_client_name = new javax.swing.JLabel();
        lbl_branch = new javax.swing.JLabel();
        jcb_countryCode = new javax.swing.JComboBox<>();
        btn_add = new javax.swing.JButton();
        btn_clear = new javax.swing.JButton();
        btn_cancel = new javax.swing.JButton();
        jcb_assigned_to = new javax.swing.JComboBox<>();
        jLabel1 = new javax.swing.JLabel();

        lbl_email.setText("Email Adress");

        jbl_phone.setText("Phone Number");

        jcb_branch.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jcb_branchActionPerformed(evt);
            }
        });

        tf_email.setForeground(new java.awt.Color(102, 102, 102));
        tf_email.setToolTipText("example@mail.ru");

        lbl_client_name.setText("Client Name");

        lbl_branch.setText("Branch");

        jcb_countryCode.setFont(new java.awt.Font("Helvetica Neue", 1, 12)); // NOI18N
        jcb_countryCode.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "+93 Afghanistan", "+358 Aland Islands", "+355 Albania", "+213 Algeria", "+1684 AmericanSamoa", "+376 Andorra", "+244 Angola", "+1264 Anguilla", "+672 Antarctica", "+1268 Antigua and Barbuda", "+54 Argentina", "+374 Armenia", "+297 Aruba", "+61 Australia", "+43 Austria", "+994 Azerbaijan", "+1242 Bahamas", "+973 Bahrain", "+880 Bangladesh", "+1246 Barbados", "+375 Belarus", "+32 Belgium", "+501 Belize", "+229 Benin", "+1441 Bermuda", "+975 Bhutan", "+591 Bolivia, Plurinational State of", "+387 Bosnia and Herzegovina", "+267 Botswana", "+55 Brazil", "+246 British Indian Ocean Territory", "+673 Brunei Darussalam", "+359 Bulgaria", "+226 Burkina Faso", "+257 Burundi", "+855 Cambodia", "+237 Cameroon", "+1 Canada", "+238 Cape Verde", "+ 345 Cayman Islands", "+236 Central African Republic", "+235 Chad", "+56 Chile", "+86 China", "+61 Christmas Island", "+61 Cocos (Keeling) Islands", "+57 Colombia", "+269 Comoros", "+242 Congo", "+243 Congo, The Democratic Republic of the Congo", "+682 Cook Islands", "+506 Costa Rica", "+225 Cote d'Ivoire", "+385 Croatia", "+53 Cuba", "+357 Cyprus", "+420 Czech Republic", "+45 Denmark", "+253 Djibouti", "+1767 Dominica", "+1849 Dominican Republic", "+593 Ecuador", "+20 Egypt", "+503 El Salvador", "+240 Equatorial Guinea", "+291 Eritrea", "+372 Estonia", "+251 Ethiopia", "+500 Falkland Islands (Malvinas)", "+298 Faroe Islands", "+679 Fiji", "+358 Finland", "+33 France", "+594 French Guiana", "+689 French Polynesia", "+241 Gabon", "+220 Gambia", "+995 Georgia", "+49 Germany", "+233 Ghana", "+350 Gibraltar", "+30 Greece", "+299 Greenland", "+1473 Grenada", "+590 Guadeloupe", "+1671 Guam", "+502 Guatemala", "+44 Guernsey", "+224 Guinea", "+245 Guinea-Bissau", "+595 Guyana", "+509 Haiti", "+379 Holy See (Vatican City State)", "+504 Honduras", "+852 Hong Kong", "+36 Hungary", "+354 Iceland", "+91 India", "+62 Indonesia", "+98 Iran, Islamic Republic of Persian Gulf", "+964 Iraq", "+353 Ireland", "+44 Isle of Man", "+972 Israel", "+39 Italy", "+1876 Jamaica", "+81 Japan", "+44 Jersey", "+962 Jordan", "+77 Kazakhstan", "+254 Kenya", "+686 Kiribati", "+850 Korea, Democratic People's Republic of Korea", "+82 Korea, Republic of South Korea", "+965 Kuwait", "+996 Kyrgyzstan", "+856 Laos", "+371 Latvia", "+961 Lebanon", "+266 Lesotho", "+231 Liberia", "+218 Libyan Arab Jamahiriya", "+423 Liechtenstein", "+370 Lithuania", "+352 Luxembourg", "+853 Macao", "+389 Macedonia", "+261 Madagascar", "+265 Malawi", "+60 Malaysia", "+960 Maldives", "+223 Mali", "+356 Malta", "+692 Marshall Islands", "+596 Martinique", "+222 Mauritania", "+230 Mauritius", "+262 Mayotte", "+52 Mexico", "+691 Micronesia, Federated States of Micronesia", "+373 Moldova", "+377 Monaco", "+976 Mongolia", "+382 Montenegro", "+1664 Montserrat", "+212 Morocco", "+258 Mozambique", "+95 Myanmar", "+264 Namibia", "+674 Nauru", "+977 Nepal", "+31 Netherlands", "+599 Netherlands Antilles", "+687 New Caledonia", "+64 New Zealand", "+505 Nicaragua", "+227 Niger", "+234 Nigeria", "+683 Niue", "+672 Norfolk Island", "+1670 Northern Mariana Islands", "+47 Norway", "+968 Oman", "+92 Pakistan", "+680 Palau", "+970 Palestinian Territory, Occupied", "+507 Panama", "+675 Papua New Guinea", "+595 Paraguay", "+51 Peru", "+63 Philippines", "+872 Pitcairn", "+48 Poland", "+351 Portugal", "+1939 Puerto Rico", "+974 Qatar", "+40 Romania", "+7 Russia", "+250 Rwanda", "+262 Reunion", "+590 Saint Barthelemy", "+290 Saint Helena, Ascension and Tristan Da Cunha", "+1869 Saint Kitts and Nevis", "+1758 Saint Lucia", "+590 Saint Martin", "+508 Saint Pierre and Miquelon", "+1784 Saint Vincent and the Grenadines", "+685 Samoa", "+378 San Marino", "+239 Sao Tome and Principe", "+966 Saudi Arabia", "+221 Senegal", "+381 Serbia", "+248 Seychelles", "+232 Sierra Leone", "+65 Singapore", "+421 Slovakia", "+386 Slovenia", "+677 Solomon Islands", "+252 Somalia", "+27 South Africa", "+211 South Sudan", "+500 South Georgia and the South Sandwich Islands", "+34 Spain", "+94 Sri Lanka", "+249 Sudan", "+597 Suriname", "+47 Svalbard and Jan Mayen", "+268 Swaziland", "+46 Sweden", "+41 Switzerland", "+963 Syrian Arab Republic", "+886 Taiwan", "+992 Tajikistan", "+255 Tanzania, United Republic of Tanzania", "+66 Thailand", "+670 Timor-Leste", "+228 Togo", "+690 Tokelau", "+676 Tonga", "+1868 Trinidad and Tobago", "+216 Tunisia", "+90 Turkey", "+993 Turkmenistan", "+1649 Turks and Caicos Islands", "+688 Tuvalu", "+256 Uganda", "+380 Ukraine", "+971 United Arab Emirates", "+44 United Kingdom", "+1 United States", "+598 Uruguay", "+998 Uzbekistan", "+678 Vanuatu", "+58 Venezuela, Bolivarian Republic of Venezuela", "+84 Vietnam", "+1284 Virgin Islands, British", "+1340 Virgin Islands, U.S.", "+681 Wallis and Futuna", "+967 Yemen", "+260 Zambia", "+263 Zimbabwe" }));
        jcb_countryCode.setSelectedIndex(109);

        btn_add.setText("Save");
        btn_add.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btn_addActionPerformed(evt);
            }
        });

        btn_clear.setText("Clear");

        btn_cancel.setText("Cancel");
        btn_cancel.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btn_cancelActionPerformed(evt);
            }
        });

        jcb_assigned_to.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Item 1", "Item 2", "Item 3", "Item 4" }));
        jcb_assigned_to.setEnabled(false);

        jLabel1.setText("Assign to Salesman N#");

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGap(26, 26, 26)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jcb_assigned_to, javax.swing.GroupLayout.PREFERRED_SIZE, 153, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(jcb_countryCode, javax.swing.GroupLayout.PREFERRED_SIZE, 130, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(tf_phone, javax.swing.GroupLayout.PREFERRED_SIZE, 104, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addComponent(jbl_phone)
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(lbl_email)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(tf_email, javax.swing.GroupLayout.PREFERRED_SIZE, 146, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(lbl_branch)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(jcb_branch, javax.swing.GroupLayout.PREFERRED_SIZE, 126, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addComponent(jLabel1)
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(btn_add)
                        .addGap(18, 18, 18)
                        .addComponent(btn_clear)
                        .addGap(18, 18, 18)
                        .addComponent(btn_cancel)))
                .addGap(0, 30, Short.MAX_VALUE))
            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addGroup(layout.createSequentialGroup()
                    .addGap(28, 28, 28)
                    .addComponent(lbl_client_name)
                    .addGap(12, 12, 12)
                    .addComponent(tf_client_name, javax.swing.GroupLayout.PREFERRED_SIZE, 146, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addContainerGap(51, Short.MAX_VALUE)))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                .addGap(63, 63, 63)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lbl_email)
                    .addComponent(tf_email, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(18, 18, 18)
                .addComponent(jbl_phone)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jcb_countryCode, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(tf_phone, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lbl_branch)
                    .addComponent(jcb_branch, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(18, 18, 18)
                .addComponent(jLabel1)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(jcb_assigned_to, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(btn_add)
                    .addComponent(btn_clear)
                    .addComponent(btn_cancel))
                .addContainerGap(32, Short.MAX_VALUE))
            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addGroup(layout.createSequentialGroup()
                    .addGap(27, 27, 27)
                    .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(tf_client_name, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(lbl_client_name))
                    .addContainerGap(278, Short.MAX_VALUE)))
        );
    }// </editor-fold>//GEN-END:initComponents

    private void btn_addActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btn_addActionPerformed
        boolean valid = validateFields();
        if (valid) {saveClient();}
    }//GEN-LAST:event_btn_addActionPerformed

    private void jcb_branchActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jcb_branchActionPerformed
        Branch branch = this.organization.getBranches().get(jcb_branch.getSelectedIndex());
        if (branch != null) {populateAssignedToComboBox(branch);}
    }//GEN-LAST:event_jcb_branchActionPerformed

    private void btn_cancelActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btn_cancelActionPerformed
        this.jd.dispose(); // close action
    }//GEN-LAST:event_btn_cancelActionPerformed
    
    private boolean validateFields()
    {
        String client_name = (String) tf_client_name.getText();
        
        if (!client_name.matches("^[a-zA-Z\\s'-]+$"))
        {
            JOptionPane.showMessageDialog(null, "Please enter client name properly");
            return false;
        }
        
        String email = (String) tf_email.getText();
        if (!email.matches("^[^@\\s]+@[^@\\s\\.]+\\.[^@\\s]+$"))
        {
            JOptionPane.showMessageDialog(null, "Please enter email in format (example@mail.com)");
            return false;
        }
        
        String phone = (String) tf_phone.getText();
        
        if (!phone.matches("^\\d[\\d -]*\\d$"))
        {
            JOptionPane.showMessageDialog(null, "Please enter phone number (e.g 555-1729)");
            return false;
        }
        if (jcb_branch.getSelectedIndex()==0)
        {
            JOptionPane.showMessageDialog(null, "Please specify Client's Branch!");
            return false;
        }
        return true;
    }
    private void saveClient()
    {
        String client_name = (String) tf_client_name.getText();
        String email = (String) tf_email.getText();
        String phone = (String) tf_phone.getText();
        int branch_id = jcb_branch.getSelectedIndex();
        
        Client client = new Client(client_name, branch_id, phone, email);
        
        if (client!=null){
            this.organization.addClient(client);
            this.clientRecords.addRow(client.getRow());
        }
        else {JOptionPane.showMessageDialog(null, "Could not add client");}
    }
    public void populateAssignedToComboBox(Branch branch){
        Department sales = branch.getSpecificDepartment(HierarchyLevel.SALES);
        if (sales!=null)
        {
            List<String> salesReps = sales.getRolesTakenByEmployee().get("Sales Representative");
            if (salesReps!=null)
            {
                String[] reps = salesReps.toArray(new String[0]);
                DefaultComboBoxModel<String> model = new DefaultComboBoxModel<>(reps);
                jcb_assigned_to.setModel(model);
            }
        }
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btn_add;
    private javax.swing.JButton btn_cancel;
    private javax.swing.JButton btn_clear;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jbl_phone;
    private javax.swing.JComboBox<String> jcb_assigned_to;
    private javax.swing.JComboBox<String> jcb_branch;
    private javax.swing.JComboBox<String> jcb_countryCode;
    private javax.swing.JLabel lbl_branch;
    private javax.swing.JLabel lbl_client_name;
    private javax.swing.JLabel lbl_email;
    private javax.swing.JTextField tf_client_name;
    private javax.swing.JTextField tf_email;
    private javax.swing.JTextField tf_phone;
    // End of variables declaration//GEN-END:variables
}
